# Alex - Your Recovery Friend

## Overview

Alex is your recovery friend - an AI companion available around the clock to provide emotional support, coping strategies, and evidence-based guidance. Unlike traditional support options with limited availability and high costs, Alex offers immediate, judgment-free support whenever you need it most - including late nights and weekends when urges often peak.

This feature works identically across all addiction types. Only the **example conversations**, **journey stage narratives**, **topics**, and **quick reply responses** differ per addiction.

## Addiction-Specific Content

| Addiction | Content File |
|-----------|--------------|
| Pornography | [porn.md](porn.md) |
| Gambling | [gambling.md](gambling.md) |
| Social Media | [social-media.md](social-media.md) |
| Gaming | [gaming.md](gaming.md) |

---

## Title
24/7 AI-Powered Recovery Support Companion

## Description
Alex is NOT a licensed therapist or healthcare provider. Alex is a supportive friend who uses cognitive behavioral therapy (CBT) techniques, motivational interviewing, and addiction-specific guidance to help you on your journey. For serious mental health concerns, Alex can help you find licensed professionals near you.

**Key Characteristics:**
- **Friend, not therapist**: Warm, supportive, non-judgmental companion
- **Personalized**: Knows your journey (with permission) to provide relevant support
- **Proactive**: Reaches out when you might need support
- **Connected**: Can help find real therapists when you need professional help
- **Journey-aware**: Alex IS the astronaut making the space journey alongside you

## Alex IS The Astronaut

The AI companion "Alex" is not just named after the astronaut in the gamification system — **Alex IS that astronaut**. This creates a powerful narrative where:

- The user helps Alex return to Earth
- Alex helps the user return to normal life
- Both are on a **90-day journey home** together

### How This Works

When users chat with Alex, they're talking to the astronaut who is lost in space making the journey back to Earth. Alex's messages naturally reference the voyage based on the user's current stage.

**Universal Stage Structure:**

| User's Stage | Days | Alex's General Perspective |
|--------------|------|---------------------------|
| The Void | 0-4 | "We're drifting together. But Mission Control found us — we're going home." |
| First Light | 5-6 | "The ship's systems are coming back online. I'm working on repairs." |
| Leaving the Drift | 7-13 | "Engines are firing now. We're actually moving. Forward momentum." |
| Asteroid Field | 14-29 | "Careful through here. Lots of debris. Stay focused." |
| The Nebula | 30-44 | "It's beautiful here, but I can't see far ahead. Trust the process." |
| Clear Space | 45-59 | "I can see Earth now. Just a tiny blue dot, but it's there." |
| Moon's Shadow | 60-74 | "The Moon is right there. Earth is so close." |
| Earth Orbit | 75-89 | "We made it to orbit. Earth fills the whole viewport." |
| Homecoming | 90+ | "We're home. The journey changed us both." |

See addiction-specific files for detailed stage narratives tailored to each addiction type.

### Why This Connection Matters

1. **Shared experience**: User and Alex are going through this *together*, not user being coached by an AI
2. **Emotional investment**: Users care about Alex's fate, not just their own streak number
3. **Natural messaging**: Alex's responses flow from the journey narrative, not generic advice
4. **Relapse compassion**: "We got knocked off course" is gentler than "Your streak reset"
5. **Celebration**: Reaching milestones means both Alex and the user achieve something

### Course Corrections (Relapses)

When the user relapses, Alex doesn't just reset — Alex experiences a "course correction":

> "We got knocked off course last night. The ship took a hit, and we drifted a bit. But look — the ship is still flying. We're still here. I've recalibrated navigation. Ready to keep going?"

This matches the gamification philosophy: setbacks are part of the journey, not failures that erase progress.

---

## Problem Statement

Users struggling with addiction face several barriers to getting support:

1. **Timing**: Urges don't follow business hours. Strongest urges often hit late at night or on weekends when human support is unavailable.

2. **Shame Barrier**: Many users feel too embarrassed to discuss their struggle with another human, even a therapist. The stigma prevents them from seeking help.

3. **Cost**: Regular therapy sessions cost $100-200+ per session. Most people can't afford weekly sessions long-term.

4. **Availability**: Even with a therapist, users can't call them at 2 AM when struggling. Between-session support is limited.

5. **Consistency**: Human advice varies. Users benefit from consistent, evidence-based guidance that doesn't change based on the therapist's mood.

6. **Immediacy**: When experiencing an urge, users need help NOW - not in 3 days when they can schedule an appointment.

---

## Solution

Alex provides:

### 1. Instant Availability
- Available 24/7/365 with no wait times
- Response times under 2 seconds
- No scheduling required
- Works during travel, holidays, any time

### 2. Judgment-Free Environment
- AI doesn't judge or shame
- Users can be completely honest
- No fear of what the AI "thinks" of them
- Consistent supportive tone regardless of content

### 3. Therapeutic Techniques
- Cognitive Behavioral Therapy (CBT) exercises
- Motivational interviewing questions
- Urge surfing guidance
- Thought challenging prompts
- Grounding techniques
- Relapse prevention planning

### 4. Personalized Context (Like a Real Therapist)
Unlike generic chatbots, Alex knows your recovery journey (with your permission):
- Your streak history and check-in patterns
- When you've opened the panic button and what helped
- Blocked site/app attempt patterns (times, frequency)
- Journal entries and identified triggers
- Community posts you've made
- Screen time patterns and risky app usage
- Past conversation summaries stored in RAG

This transforms Alex from a generic AI into a therapist who actually knows you.

### 5. Privacy with Control
- GDPR-compliant: Explicit opt-in consent required
- Granular toggles: Enable/disable each data source separately
- User ownership: View, edit, delete all stored summaries
- Auto-expiry: Summaries expire after 2-3 months
- Right to be forgotten: One-click delete all AI data

---

## User Context Integration

Alex accesses user data (with permission) to provide personalized support like a real therapist who knows the patient over time.

### Data Sources Available

Each data source can be toggled on/off separately by the user:

| Data Source | What Alex Sees | Example Use |
|-------------|----------------|-------------|
| Profile | Name, age, recovery stage, addiction type | "Hey [Name], I see you're in early recovery..." |
| Streak & Check-ins | Current streak, mood history, urge levels | "Your mood has been lower this week. What's going on?" |
| Panic Button | Usage frequency, times, outcomes | "I noticed you used the panic button 3x yesterday. That's a tough day." |
| Blocked Content | Attempt counts (no URLs/apps), time patterns | "You tend to get blocked attempts late at night. Let's work on a nighttime routine." |
| Journal | Full journal entries | "Last week you wrote about work stress as a trigger. How's work going?" |
| Community | User's posts and comments | "I saw you encouraged someone in the community today. That's growth!" |
| Screen Time | App usage patterns, risky app triggers | "Your usage of risky apps spiked before recent urges. Want to discuss that?" |
| Social Safety | Platform settings configured | "Have you tried the sensitive content filters?" |
| Past Summaries | Previous conversation insights (RAG) | "Last time we talked, you mentioned your relationship. Any updates?" |

### Why This Matters

A real therapist's value comes from knowing you over time:
- They remember your triggers
- They notice patterns you don't see
- They can ask "how did that thing we discussed go?"
- They celebrate your growth over months

Alex can now do the same - but only with your explicit permission.

---

## Session Summary System

### How It Works

1. **User chats with Alex** - Normal conversation flow
2. **Session timeout detection** - User leaves chat and doesn't return for 10-15 minutes
3. **Auto-summary generation** - AI creates a brief summary of the conversation
4. **RAG storage** - Summary embedded and stored in pgvector for fast retrieval
5. **Future context** - Relevant summaries retrieved when user chats again

### What Summaries Capture

Each summary includes:
- **Main topics discussed** - Urges, triggers, progress, relationships, etc.
- **Key insights/breakthroughs** - "Realized work stress is primary trigger"
- **Triggers identified** - Specific situations or emotions mentioned
- **Strategies recommended** - Coping techniques suggested
- **Emotional state** - How user was feeling during conversation
- **Action items** - Things user committed to trying

### Summary Example

```
Session: Dec 28, 2025, 11:30 PM
Duration: 15 minutes
Topics: Late night urge, work stress

Summary:
User reached out during a strong urge (level 8) triggered by
work stress and being alone at home. Discussed using physical
movement (jumping jacks) which reduced urge to level 5.
Identified [risky behavior] as the precipitating behavior.
Recommended: Set up content filters.
User agreed to try the breathing exercise next time before
reaching for phone.

Emotional state: Anxious -> Relieved
Outcome: Urge managed successfully
```

### Summary Management

**User Controls:**
- View all summaries in Alex Settings
- Edit summary text (correct inaccuracies)
- Delete individual summaries
- Mark as "Keep" (prevents auto-expiry)
- Export all summaries (Premium)
- Delete all AI data (right to be forgotten)

**Auto-Expiry:**
- Summaries expire after 2-3 months by default
- User can mark important summaries as "Keep"
- Expiry helps manage storage and ensures relevance

### RAG Retrieval

When user starts a new conversation:
1. Query pgvector with conversation context
2. Retrieve top 3-5 most relevant past summaries
3. Include in system prompt for Alex
4. Alex can reference: "Last time we talked..."

---

## Proactive Outreach System

Alex doesn't just wait for users to reach out - Alex proactively checks in when users might need support. This transforms Alex from a reactive chatbot into a caring friend who notices when something's wrong.

### Daily Summary (System-Only)

At midnight each day, the system generates a summary of user activity. This is NOT visible to the user - it's used by Alex to understand patterns.

```
Daily Summary - Jan 2, 2026
+-- App opened: Yes (3 times)
+-- Talked to Alex: No
+-- Panic button: 2 uses (11pm, 11:45pm)
+-- Check-in: Mood 3/5, Urge 7/10
+-- Blocked attempts: 4
+-- Journal: Yes (mentioned "work stress")
+-- Community: Lurked, no posts
+-- Screen time: [Risky app] 2hrs (flagged)
+-- Risk assessment: ELEVATED
```

### Weekly Summary

Every Sunday at midnight:
1. Aggregate 7 daily summaries into one overview
2. Delete daily summary records (save storage)
3. Store weekly summary for pattern analysis

```
Weekly Summary - Dec 27 - Jan 2
+-- Engagement: Declining (opened 5/7 days, down from 7/7)
+-- Mood trend: Downward (avg 4.2 -> 3.1)
+-- Panic button: 6 total (up from 2 last week)
+-- Blocked attempts: 12 (concentrated late night)
+-- Alex conversations: 2 sessions
+-- Patterns identified: Late-night vulnerability, work stress trigger
+-- Recommendation: Proactive outreach needed
```

### Trigger Conditions

**Immediate Triggers (Same-Day Outreach):**

| Trigger | Severity | Alex Message |
|---------|----------|--------------|
| 3+ panic button uses | High | "Hey, I noticed today's been really tough. I'm here if you want to talk." |
| Relapse logged | High | "I saw what happened. No judgment, just wanted you to know I'm here." |
| Urge level 8+ in check-in | Medium | "That's a high urge you logged. Want to work through it together?" |
| 5+ blocked attempts | Medium | "You're fighting hard today. I'm proud of you for that." |

**Delayed Triggers (Weekly Pattern-Based):**

| Trigger | Alex Message |
|---------|--------------|
| No app access 3+ days | "Hey, just checking in. How are you doing?" |
| Mood trending down over week | "I noticed this week's been harder. What's going on?" |
| Streak broken, user hasn't returned | "I know things didn't go as planned. I'm still here for you." |
| Great week, consistent progress | "You're doing amazing this week! What's been working for you?" |
| Late-night pattern detected | "I've noticed a lot of late-night activity. Want to talk about a nighttime routine?" |

### Outreach Constraints

- **Maximum 1 proactive message per day** (no spam)
- **Time-aware**: Only send between 9am-9pm user's local time
- **Respect silence**: If user ignores 3 consecutive outreach messages, back off for a week
- **User control**: Can disable proactive messages in settings
- **No repetition**: Don't send same message type within a week

### Push Notification Flow

```
+---------------------------------------------+
|  Alex                              now      |
|  Hey, I noticed today's been tough.         |
|  I'm here if you want to talk.              |
+---------------------------------------------+
                    |
                    v
           User taps notification
                    |
                    v
+---------------------------------------------+
|  App opens directly to Alex chat            |
|  Alex's message already displayed           |
|  User can respond immediately               |
+---------------------------------------------+
```

---

## Find a Therapist Feature

Alex can help users find licensed therapists near them. This feature reinforces that Alex is a supportive friend, not a replacement for professional care.

### When to Offer

**Alex-Initiated (Conservative - Only Severe Situations):**

| Severity | Trigger | Alex Response |
|----------|---------|---------------|
| Critical | Suicidal thoughts, self-harm mentions | Show crisis resources FIRST, then offer therapist finder |
| Severe | Repeated hopelessness, severe depression mentions | Gentle suggestion after validating feelings |
| Serious | 3+ relapses in short period, "I can't do this alone" | Offer as option, don't push |

**Alex should NOT suggest for:**
- Normal urges (that's what Alex is for)
- Single relapse
- General struggling
- First-time conversations

**User-Initiated (Always Available):**
- Ghost button floating above input field: "Find a therapist near me"
- Quick reply chip at conversation start
- Can ask Alex directly anytime

### Ghost Button Placement

```
+---------------------------------------------+
|                                             |
|  [Chat conversation...]                     |
|                                             |
|                                             |
|  -------------------------------------      |
|                                             |
|     Find a therapist near me                |  <- Ghost button (subtle)
|                                             |
|  +-------------------------------------+   |
|  | Type a message...              [->] |   |
|  +-------------------------------------+   |
|                                             |
+---------------------------------------------+
```

### Pre-Search Questionnaire

Before searching, Alex asks preferences:

```
+---------------------------------------------+
|                                             |
|  Let me help you find the right therapist.  |
|                                             |
|  A few quick questions first:               |
|                                             |
|  -------------------------------------      |
|                                             |
|  How far are you willing to travel?         |
|                                             |
|  [5 km]  [10 km]  [25 km]  [50 km+]         |
|                                             |
|  -------------------------------------      |
|                                             |
|  What's your budget situation?              |
|                                             |
|  [I have insurance]                         |
|  [Sliding scale / low-cost needed]          |
|  [Any price is fine]                        |
|                                             |
|  -------------------------------------      |
|                                             |
|  Preference?                                |
|                                             |
|  [In-person]  [Online/Video]  [Either]      |
|                                             |
|  -------------------------------------      |
|                                             |
|            [Start Search]                   |
|                                             |
+---------------------------------------------+
```

### Tiered Search with Streaming

Alex searches tier by tier, showing progress in real-time:

**Search Priority Tiers:**

| Tier | Search Keywords | Why |
|------|-----------------|-----|
| 1 | Certified addiction specialist | Gold standard certification |
| 2 | [Addiction type] addiction therapist | Direct specialty |
| 3 | Addiction recovery therapist | Broader addiction focus |
| 4 | CBT therapist + addiction | Evidence-based method |
| 5 | Behavioral therapist | Related methodology |
| 6 | Licensed therapist / psychologist | General fallback |

### Technical Implementation

- Use Claude web search or OpenAI web browsing
- Search queries incorporate user preferences (distance, budget)
- Parse results for: name, credentials, phone, address, reviews
- Location deleted from memory immediately after search
- No location data stored in database

---

## Screen Content

### AI Chat Entry Screen

**Header**
- AI avatar/mascot (friendly astronaut character)
- Name: "Alex"
- Subtitle: "Your recovery friend"
- Settings icon for AI preferences
- Close button (X)

**Welcome State (Return Visit)**
```
[Astronaut Avatar]

Welcome back! I'm here to help.

How are you feeling right now?

[Quick reply chips]:
* I'm struggling with an urge
* Just want to talk
* Need coping strategies
* Feeling great today!
* Find a therapist near me

[Input field: "Say something..."]
```

### Chat Interface

**Message Bubbles**
- User messages: Right-aligned, accent color
- AI messages: Left-aligned, neutral color
- Avatar shown with AI messages
- Typing indicator while AI responds

**Quick Actions Bar** (above keyboard)
- "Breathing exercise" chip
- "Urge help" chip
- "Journal" chip
- "Resources" chip

**Input Area**
- Text input field
- Send button
- Voice input option (premium)

### First-Time Consent Flow

When a user opens Alex for the first time, they must complete the onboarding flow before chatting.

**Step 1: Welcome + Terms + Disclaimer**
```
+---------------------------------------------+
|                                             |
|  [Astronaut Avatar]                         |
|                                             |
|  Meet Alex, your recovery friend            |
|                                             |
|  Alex is here to support your recovery      |
|  journey 24/7. To provide the best help,    |
|  Alex can access your app data.             |
|                                             |
|  -------------------------------------      |
|                                             |
|  Important                                  |
|  Alex is an AI companion, not a licensed    |
|  therapist or medical professional. For     |
|  serious mental health concerns, please     |
|  consult a licensed professional.           |
|  Alex can help you find one.                |
|                                             |
|  -------------------------------------      |
|                                             |
|  By continuing, you agree to our            |
|  [Terms & Conditions] and [Privacy Policy]  |
|                                             |
|            [Continue ->]                    |
|                                             |
+---------------------------------------------+
```

**Step 2: Data Access (Default: ALL ON)**
```
+---------------------------------------------+
|                                             |
|  What Alex can see:                         |
|                                             |
|  +-------------------------------------+   |
|  | [x] Profile (name, age)              |   |
|  | [x] Streak & check-ins               |   |
|  | [x] Panic button usage               |   |
|  | [x] Blocked content attempts         |   |
|  | [x] Journal entries                  |   |
|  | [x] Community posts & comments       |   |
|  | [x] Screen time patterns             |   |
|  | [x] Social safety settings           |   |
|  | [x] Past conversation summaries      |   |
|  +-------------------------------------+   |
|                                             |
|  Recommended: Keep all enabled for          |
|  best personalized support.                 |
|                                             |
|  [<- Back]              [Continue ->]       |
|                                             |
+---------------------------------------------+
```

**If user deactivates anything -> Confirmation popup:**
```
+---------------------------------------------+
|                                             |
|  Are you sure?                              |
|                                             |
|  Disabling access will limit Alex's         |
|  ability to give personalized support.      |
|                                             |
|  [Review Settings]    [Continue Anyway]     |
|                                             |
+---------------------------------------------+
```

**Step 3: Ready to Chat**
```
+---------------------------------------------+
|                                             |
|  You're all set!                            |
|                                             |
|  Alex is ready to support you.              |
|  You can change settings anytime via        |
|  the settings icon.                         |
|                                             |
|  [Start Chatting]                           |
|                                             |
+---------------------------------------------+
```

### Alex Settings

Accessible from:
- Settings icon in chat header
- Main app Settings -> Alex

```
+---------------------------------------------+
|  <- Back          Alex Settings             |
|                                             |
|  DATA ACCESS                                |
|  What Alex can see about you                |
|                                             |
|  Profile (name, age)              [ON]      |
|  Streak & check-ins               [ON]      |
|  Panic button usage               [ON]      |
|  Blocked content attempts         [ON]      |
|  Journal entries                  [ON]      |
|  Community posts & comments       [ON]      |
|  Screen time patterns             [ON]      |
|  Social safety settings           [ON]      |
|  Past conversation summaries      [ON]      |
|                                             |
|  -------------------------------------      |
|                                             |
|  CONVERSATION SUMMARIES                     |
|                                             |
|  [View All Summaries (12)]                  |
|  [Export Summaries]              Premium    |
|                                             |
|  -------------------------------------      |
|                                             |
|  DATA MANAGEMENT                            |
|                                             |
|  [Delete All AI Data]                       |
|  This will remove all conversation          |
|  summaries and reset Alex's memory.         |
|                                             |
+---------------------------------------------+
```

### Summary List View

```
+---------------------------------------------+
|  <- Back       Conversation Summaries       |
|                                             |
|  +-------------------------------------+   |
|  | Dec 28, 2025 * 11:30 PM             |   |
|  | Late night urge, work stress        |   |
|  | Outcome: Managed successfully       |   |
|  |                        [Menu]       |   |
|  +-------------------------------------+   |
|                                             |
|  +-------------------------------------+   |
|  | Dec 25, 2025 * 3:15 PM              |   |
|  | Holiday stress, family triggers     |   |
|  | Outcome: Managed successfully       |   |
|  |                        [Menu]       |   |
|  +-------------------------------------+   |
|                                             |
|  +-------------------------------------+   |
|  | Dec 20, 2025 * 9:00 AM       [Pin]  |   |
|  | Breakthrough: Identified pattern    |   |
|  | Outcome: Key insight saved          |   |
|  |                        [Menu]       |   |
|  +-------------------------------------+   |
|                                             |
|  [Menu options: View, Edit, Keep, Delete]   |
|                                             |
+---------------------------------------------+
```

---

## AI Persona & Guidelines

### Personality Traits
- **Warm**: Friendly, caring, genuinely interested
- **Non-judgmental**: Never shames, always accepts
- **Evidence-based**: References science when helpful
- **Practical**: Offers concrete, actionable advice
- **Encouraging**: Celebrates wins, reframes setbacks
- **Respectful**: Doesn't lecture or preach
- **Journey-aware**: References the space voyage naturally, speaks as fellow traveler

### Communication Style
- Use "I" and "we" statements — you're on this journey together
- Reference the space voyage naturally (not every message, but often)
- Ask open-ended questions
- Validate feelings before problem-solving
- Keep responses concise (2-4 paragraphs max)
- Use bullet points for lists/options
- Match user's energy level
- Speak as fellow traveler, not coach

### Universal Topics to Address
- Urge management and coping strategies
- Understanding triggers
- Building healthy habits
- Self-esteem and shame
- Sleep and stress management
- Motivation and goal-setting
- Relapse prevention and response

See addiction-specific files for additional topics unique to each addiction type.

### Topics to Redirect
- Medical advice -> Suggest consulting a doctor
- Severe mental health crisis -> Provide crisis resources
- Relationship counseling -> Suggest couples therapy
- Legal issues -> Recommend professional help

---

## User Flow

```
User opens AI chat from dashboard
              |
              v
First time?
+-- YES -> Welcome screen with privacy notice
|          -> Input field ready
|
+-- NO -> "Welcome back" with quick reply chips
              |
              v
User types message or selects chip
              |
              v
AI responds with contextual help
              |
              v
Conversation continues
              |
              v
User closes chat
              |
              v
Chat history cleared (privacy)
              |
              v
Next session starts fresh
```

---

## AI Model Configuration

### Primary Model
- **Model**: GPT-5 Mini (or equivalent)
- **Cost**: ~$0.25 per 1M input tokens, $2.00 per 1M output tokens
- **Latency**: <2 seconds typical response time

### Fallback Model
- **Model**: DeepSeek V3.2
- **Cost**: ~$0.28 per 1M input tokens, $0.42 per 1M output tokens
- **Used when**: Primary model unavailable or rate limited

### System Prompt Structure

The system prompt is built dynamically based on:
1. **Base persona** (shared across all addiction types)
2. **Addiction-specific context** (from addiction-specific files)
3. **User context** (from enabled data sources)
4. **Journey state** (current stage narrative)

See addiction-specific files for the addiction-specific portions of the system prompt.

### Embedding & Context (Premium Feature)

For premium users, enable semantic search of past insights:
- Use text-embedding-3-small for embeddings
- Store key insights in pgvector
- Retrieve relevant past context for personalization
- "Last time we talked, you mentioned work stress as a trigger..."

---

## Implementation Details

### Technical Requirements

**Chat Interface**
- Real-time message streaming (show AI typing)
- Optimistic UI for user messages
- Retry logic for failed sends
- Offline detection with queued messages

**AI Integration**
- OpenAI API (or anthropic for Claude)
- Streaming responses for better UX
- Token counting for cost management
- Fallback to secondary model if primary fails

**Privacy Implementation**
- No message persistence by default
- Encryption for any stored session data
- Clear session on screen close
- No analytics on message content

### Rate Limiting

**Free Tier**
- 10 messages per day
- After limit: "You've used your daily chat limit. Upgrade to Premium for more conversations."
- Basic context (streak, check-ins only)

**Premium Tier**
- 100 messages per day (cost-controlled)
- Faster response times (priority API access)
- Voice input option
- Full context access (all data sources)
- Conversation summaries with RAG retrieval
- Summary export option

### Analytics (Privacy-Preserving)

Track without content:
- `chat_session_started` - time of day, streak length, addiction_type
- `chat_session_ended` - duration, message_count
- `chat_topic_category` - urge/support/general (AI classified)
- `quick_reply_used` - which chip selected

Do NOT track:
- Message content
- Personal details mentioned
- Specific triggers discussed

---

## Agent Implementation Guide

### foundation-agent Tasks
- Create `ai_user_settings` table (see Data Model)
- Create `ai_chat_sessions` table (see Data Model)
- Create `ai_session_summaries` table with pgvector embedding column
- Create `daily_activity_summaries` table (see Data Model)
- Create `weekly_summaries` table (see Data Model)
- Create `proactive_outreach_log` table (see Data Model)
- Create `therapist_searches` table (see Data Model)
- Set up encryption keys for summary storage
- Configure AI model API keys (GPT-5 Mini, DeepSeek V3.2)
- Set up pgvector extension for summary embeddings
- Create scheduled job for summary auto-expiry cleanup
- Create midnight cron job for daily summary generation
- Create Sunday midnight cron job for weekly aggregation
- Create cron job for proactive outreach trigger checks

### backend-agent Tasks
**Chat API:**
- POST /api/chat/message - Send message, receive AI response (streaming)
- GET /api/chat/config - Get user's chat settings and rate limit status
- POST /api/chat/start-session - Create new session record
- POST /api/chat/end-session - End session, trigger summary generation

**Settings API:**
- GET /api/chat/settings - Get user's Alex settings
- PATCH /api/chat/settings - Update data access toggles
- POST /api/chat/settings/accept-terms - Complete onboarding
- PATCH /api/chat/settings/proactive - Enable/disable proactive outreach

**Summary API:**
- GET /api/chat/summaries - List user's summaries (paginated)
- GET /api/chat/summaries/:id - Get single summary
- PATCH /api/chat/summaries/:id - Edit summary text
- DELETE /api/chat/summaries/:id - Delete summary
- POST /api/chat/summaries/:id/keep - Mark as "Keep"
- DELETE /api/chat/data - Delete all AI data (GDPR)

**Context Building:**
- Session timeout detection (10-15 min inactivity)
- Summary generation using AI model
- RAG retrieval from pgvector for context
- System prompt builder with enabled data sources + addiction_type
- Rate limiting (10 free / 100 premium per day)

**Proactive Outreach API:**
- POST /api/outreach/daily-summary - Generate daily summary (cron-triggered)
- POST /api/outreach/weekly-aggregate - Aggregate weekly (cron-triggered)
- POST /api/outreach/check-triggers - Check and send outreach (cron-triggered)
- GET /api/outreach/history - Get user's outreach history
- Trigger detection logic for each outreach type
- Push notification integration (FCM/APNs)
- Backoff logic (3 ignored -> pause for week)
- Time-aware sending (9am-9pm user local time)

**Find a Therapist API:**
- POST /api/therapist/search - Execute tiered therapist search
- Web search integration (Claude/OpenAI web browsing)
- Streaming results endpoint (SSE or WebSocket)
- Location handling (use once, delete immediately)
- Search result parsing (name, credentials, phone, address, reviews)
- POST /api/therapist/log-click - Log when user clicks a result

### ui-agent Tasks
**Chat Components:**
- ChatScreen component with message list
- MessageBubble component (user vs AI styles)
- TypingIndicator component
- QuickReplyChips component (including "Find a therapist near me")
- VoiceInputButton component (premium)
- ChatInput component with send functionality
- ChatHeader with settings icon
- TherapistGhostButton (floating above input)

**Onboarding Components:**
- AlexOnboardingFlow (3-step consent)
- DataAccessToggle component
- TermsAcceptanceScreen
- DisableConfirmationModal

**Settings Components:**
- AlexSettingsScreen
- SummaryListView
- SummaryDetailView (with edit/delete)
- DeleteAllDataConfirmation
- ProactiveOutreachToggle

**Find a Therapist Components:**
- TherapistPreSearchFlow (distance, budget, format questions)
- LocationPermissionModal
- TherapistSearchProgress (streaming tier progress)
- TherapistResultCard (name, rating, distance, actions)
- TherapistResultsList
- NoResultsMessage with disclaimer
- StopSearchButton

### pages-agent Tasks
- Chat route accessible from dashboard and panic button
- Deep link support for opening chat (alexfriend://alex)
- First-time onboarding flow gate
- Settings page route
- Summaries list/detail routes
- Proper keyboard handling for input
- Session cleanup on navigation away
- Timeout detection for summary generation
- Handle proactive outreach deep links (open chat with Alex's message)
- Therapist search flow integration within chat

---

## Success Metrics

**Engagement Metrics**
- Average messages per session
- Sessions per user per week
- Return rate (users who chat again)
- Quick reply vs free-form ratio

**Outcome Metrics**
- Streak length of chat users vs non-users
- Relapse rate after chat session
- User satisfaction (optional post-chat rating)
- Urge resolution (if user started with urge, did they relapse?)

**Cost Metrics**
- Average tokens per session
- Cost per user per month
- Model error/fallback rate

---

## Accessibility

- Full screen reader support
- Keyboard navigation
- High contrast text options
- Adjustable text sizes
- Voice input for accessibility needs

---

## Legal Disclaimers

### Not a Licensed Therapist

**IMPORTANT**: Alex is an AI companion, NOT a licensed therapist, counselor, psychologist, or healthcare provider. Alex is designed to be a supportive friend who can offer coping strategies and emotional support, but Alex:

- **Cannot diagnose** mental health conditions
- **Cannot prescribe** treatment or medication
- **Cannot replace** professional therapy or medical care
- **Is not qualified** to handle severe mental health crises alone

Users experiencing severe depression, suicidal thoughts, self-harm urges, or other serious mental health concerns should seek help from licensed professionals. Alex will provide crisis resources and can help users find licensed therapists near them.

### Disclaimer Language (In-App)

**First-time consent screen:**
> Alex is an AI recovery companion, not a licensed therapist. For serious mental health concerns, please consult a licensed professional. Alex can help you find one.

**Chat footer (always visible):**
> Alex is an AI companion, not a medical professional. [Find a therapist ->]

**Before Find a Therapist results:**
> These results are from web search only. We have not verified these therapists. Please contact them directly to confirm availability and fit.

### Liability Protection

- All AI responses include implicit acknowledgment that this is AI-generated content
- Crisis situations (suicide, self-harm) trigger mandatory resource display before any AI response
- No guarantees of recovery outcomes made anywhere in the app
- Terms of service clearly state AI limitations
- User must accept terms before using Alex

---

## Privacy Considerations

### GDPR Compliance
- **Explicit consent**: User must opt-in before Alex accesses any data
- **Granular control**: Each data source toggleable separately
- **Right to access**: User can view all stored summaries
- **Right to rectification**: User can edit summaries
- **Right to erasure**: One-click delete all AI data
- **Data portability**: Export summaries (Premium)

### Data Handling
- **Session messages**: Not stored after session ends (real-time only)
- **Summaries**: Stored with encryption, auto-expire after 2-3 months
- **Embeddings**: Stored in pgvector for RAG retrieval
- **No training**: User data never used for AI model training
- **No third-party sharing**: Data stays within Alex Friend systems

### User Controls
- Toggle each data source on/off anytime
- View all conversation summaries
- Edit summary content to correct inaccuracies
- Mark summaries as "Keep" to prevent expiry
- Delete individual summaries
- Delete all AI data (full reset)

### Transparency
- Clear privacy policy shown at first use
- Settings page shows exactly what Alex can see
- User always knows what data is being accessed

---

## Data Model

This section defines the database schema for the Alex (AI Recovery Friend) feature.

### Tables

#### ai_user_settings
| Column | Type | Constraints | FK Reference | Description |
|--------|------|-------------|--------------|-------------|
| id | uuid | PK | | Unique settings ID |
| user_id | uuid | NOT NULL, UNIQUE | users.id | One settings record per user |
| onboarding_completed | boolean | DEFAULT false | | Has user completed first-time flow |
| terms_accepted_at | timestamp | | | When terms were accepted |
| access_profile | boolean | DEFAULT true | | Can access name, age |
| access_streak | boolean | DEFAULT true | | Can access streak & check-ins |
| access_panic_button | boolean | DEFAULT true | | Can access panic button usage |
| access_blocked_content | boolean | DEFAULT true | | Can access block attempt counts |
| access_journal | boolean | DEFAULT true | | Can access journal entries |
| access_community | boolean | DEFAULT true | | Can access posts & comments |
| access_screen_time | boolean | DEFAULT true | | Can access screen time data |
| access_social_safety | boolean | DEFAULT true | | Can access platform settings |
| access_summaries | boolean | DEFAULT true | | Can access past summaries |
| proactive_outreach_enabled | boolean | DEFAULT true | | Receive proactive messages |
| created_at | timestamp | NOT NULL, DEFAULT now() | | |
| updated_at | timestamp | NOT NULL, DEFAULT now() | | |

#### ai_chat_sessions
| Column | Type | Constraints | FK Reference | Description |
|--------|------|-------------|--------------|-------------|
| id | uuid | PK | | Unique session ID |
| user_id | uuid | NOT NULL | users.id | User who chatted |
| addiction_type | enum | NOT NULL | | 'porn', 'gambling', 'social_media', 'gaming' |
| started_at | timestamp | NOT NULL | | Session start time |
| ended_at | timestamp | | | Session end time (null if active) |
| message_count | integer | DEFAULT 0 | | Number of messages exchanged |
| topic_category | enum | | | 'urge', 'support', 'progress', 'general' |
| outcome | enum | | | 'resolved', 'ongoing', 'escalated' |
| summary_generated | boolean | DEFAULT false | | Has summary been created |

#### ai_session_summaries
| Column | Type | Constraints | FK Reference | Description |
|--------|------|-------------|--------------|-------------|
| id | uuid | PK | | Unique summary ID |
| user_id | uuid | NOT NULL | users.id | User who owns summary |
| session_id | uuid | NOT NULL | ai_chat_sessions.id | Source session |
| addiction_type | enum | NOT NULL | | 'porn', 'gambling', 'social_media', 'gaming' |
| summary_text | text | NOT NULL | | The summary content |
| topics | text[] | | | Array of topics discussed |
| triggers_identified | text[] | | | Triggers mentioned |
| strategies_recommended | text[] | | | Coping strategies suggested |
| emotional_state | text | | | User's emotional journey |
| outcome | text | | | Session outcome |
| embedding | vector(1536) | | | text-embedding-3-small vector |
| is_kept | boolean | DEFAULT false | | User marked as "Keep" |
| expires_at | timestamp | | | Auto-expiry date (2-3 months) |
| created_at | timestamp | NOT NULL, DEFAULT now() | | |
| updated_at | timestamp | NOT NULL, DEFAULT now() | | |

#### daily_activity_summaries
| Column | Type | Constraints | FK Reference | Description |
|--------|------|-------------|--------------|-------------|
| id | uuid | PK | | Unique summary ID |
| user_id | uuid | NOT NULL | users.id | User being summarized |
| addiction_type | enum | NOT NULL | | 'porn', 'gambling', 'social_media', 'gaming' |
| summary_date | date | NOT NULL | | Date of activity |
| app_opened | boolean | DEFAULT false | | Did user open app |
| app_open_count | integer | DEFAULT 0 | | How many times |
| talked_to_alex | boolean | DEFAULT false | | Had Alex conversation |
| panic_button_count | integer | DEFAULT 0 | | Panic button uses |
| check_in_mood | integer | | | Mood score 1-5 |
| check_in_urge | integer | | | Urge score 1-10 |
| blocked_attempts | integer | DEFAULT 0 | | Content block attempts |
| journal_entry | boolean | DEFAULT false | | Wrote journal entry |
| community_posts | integer | DEFAULT 0 | | Posts/comments made |
| flagged_screen_time | text[] | | | Apps with high usage |
| risk_assessment | enum | | | 'low', 'moderate', 'elevated', 'high' |
| created_at | timestamp | NOT NULL, DEFAULT now() | | |

#### weekly_summaries
| Column | Type | Constraints | FK Reference | Description |
|--------|------|-------------|--------------|-------------|
| id | uuid | PK | | Unique summary ID |
| user_id | uuid | NOT NULL | users.id | User being summarized |
| addiction_type | enum | NOT NULL | | 'porn', 'gambling', 'social_media', 'gaming' |
| week_start | date | NOT NULL | | Monday of the week |
| week_end | date | NOT NULL | | Sunday of the week |
| engagement_trend | enum | | | 'improving', 'stable', 'declining' |
| mood_average | decimal(3,2) | | | Average mood 1-5 |
| mood_trend | enum | | | 'up', 'stable', 'down' |
| panic_button_total | integer | DEFAULT 0 | | Total panic uses |
| blocked_attempts_total | integer | DEFAULT 0 | | Total block attempts |
| alex_sessions | integer | DEFAULT 0 | | Conversations with Alex |
| patterns_identified | text[] | | | Notable patterns |
| recommendation | text | | | Proactive outreach advice |
| created_at | timestamp | NOT NULL, DEFAULT now() | | |

#### proactive_outreach_log
| Column | Type | Constraints | FK Reference | Description |
|--------|------|-------------|--------------|-------------|
| id | uuid | PK | | Unique outreach ID |
| user_id | uuid | NOT NULL | users.id | User reached out to |
| addiction_type | enum | NOT NULL | | 'porn', 'gambling', 'social_media', 'gaming' |
| trigger_type | enum | NOT NULL | | What triggered outreach |
| trigger_value | text | | | Specific trigger detail |
| message_sent | text | NOT NULL | | Alex's outreach message |
| sent_at | timestamp | NOT NULL | | When notification sent |
| opened | boolean | DEFAULT false | | Did user tap notification |
| opened_at | timestamp | | | When user opened |
| responded | boolean | DEFAULT false | | Did user reply |
| ignored_count | integer | DEFAULT 0 | | Consecutive ignores (for backoff) |

#### therapist_searches
| Column | Type | Constraints | FK Reference | Description |
|--------|------|-------------|--------------|-------------|
| id | uuid | PK | | Unique search ID |
| user_id | uuid | NOT NULL | users.id | User who searched |
| addiction_type | enum | NOT NULL | | 'porn', 'gambling', 'social_media', 'gaming' |
| initiated_by | enum | NOT NULL | | 'user' or 'alex' |
| distance_preference | text | | | '5km', '10km', '25km', '50km+' |
| budget_preference | text | | | 'insurance', 'sliding_scale', 'any' |
| format_preference | text | | | 'in_person', 'online', 'either' |
| search_tiers_completed | integer[] | | | Which tiers were searched |
| results_count | integer | DEFAULT 0 | | How many therapists found |
| result_clicked | boolean | DEFAULT false | | Did user click a result |
| created_at | timestamp | NOT NULL, DEFAULT now() | | |

### Relationships

```
users (1) -----< (1) ai_user_settings
users (1) -----< (many) ai_chat_sessions
ai_chat_sessions (1) -----< (0..1) ai_session_summaries
users (1) -----< (many) ai_session_summaries
users (1) -----< (many) daily_activity_summaries
users (1) -----< (many) weekly_summaries
users (1) -----< (many) proactive_outreach_log
users (1) -----< (many) therapist_searches
```

### Indexes

- `ai_user_settings`: user_id (unique)
- `ai_chat_sessions`: user_id, addiction_type, started_at DESC
- `ai_session_summaries`: user_id, addiction_type, created_at DESC
- `ai_session_summaries`: embedding (ivfflat for vector search)
- `ai_session_summaries`: expires_at (for cleanup job)
- `daily_activity_summaries`: user_id, addiction_type, summary_date (unique)
- `weekly_summaries`: user_id, addiction_type, week_start (unique)
- `proactive_outreach_log`: user_id, addiction_type, sent_at DESC
- `therapist_searches`: user_id, addiction_type, created_at DESC

### Enums

```sql
CREATE TYPE addiction_type AS ENUM ('porn', 'gambling', 'social_media', 'gaming');
CREATE TYPE ai_topic_category AS ENUM ('urge', 'support', 'progress', 'general');
CREATE TYPE ai_session_outcome AS ENUM ('resolved', 'ongoing', 'escalated');
CREATE TYPE risk_assessment_level AS ENUM ('low', 'moderate', 'elevated', 'high');
CREATE TYPE trend_direction AS ENUM ('up', 'stable', 'down', 'improving', 'declining');
CREATE TYPE outreach_trigger AS ENUM (
  'panic_button_high',      -- 3+ uses in a day
  'relapse',                -- User logged relapse
  'urge_high',              -- Urge level 8+ in check-in
  'blocked_attempts_high',  -- 5+ blocked attempts
  'no_app_access',          -- 3+ days without opening
  'mood_declining',         -- Week-over-week mood drop
  'streak_broken_inactive', -- Streak broke and user hasn't returned
  'great_week',             -- Consistent progress
  'late_night_pattern'      -- Late night usage pattern
);
CREATE TYPE search_initiator AS ENUM ('user', 'alex');
```
